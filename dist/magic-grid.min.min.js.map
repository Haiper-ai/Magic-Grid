{"version":3,"file":"magic-grid.min.min.js","sources":["../src/Listener.js","../src/EventEmitter.js","../src/utils.js","../src/constant.js","../src/index.js"],"sourcesContent":["class Listener{\n    /*\n     Listener class holds the event,\n     handler and a unique id\n     */\n    id;\n    event;\n    handler;\n\n    constructor(id,event, handler){\n        this.id = id;\n        this.event = event;\n        this.handler = handler;\n    }\n\n}\nexport default Listener;","\nimport Listener from \"./Listener.js\";\nclass EventEmitter {\n    /*\n        array of emitter\n        emitter: takes in an event and handler\n        handler: is the function it calls\n    */\n    listeners;\n    #idCounter\n\n    constructor() {\n        this.listeners = [];\n        this.#idCounter = 0;\n    }\n\n    removeListener(id) {\n        const i = this.listeners.findIndex(listener => listener.id === id);\n        if(i !== -1){\n            this.listeners.splice(i, 1);\n            return true;\n        }\n        return false;\n    }\n\n    addListener(event,handler){\n        let id = this.#idCounter++;\n        this.listeners.push( new Listener(id, event,handler) );\n        return id;\n    }\n\n    emit(event,payload){\n        for(const listener of this.listeners){\n            if(listener.event === event){\n                listener.handler(payload);\n            }\n        }\n    }\n\n}\nexport default EventEmitter;","/**\n * @author emmanuelolaojo\n * @since 11/11/18\n */\n\n/**\n * Validates the configuration object.\n *\n * @param config - configuration object\n */\nconst checkParams = config => {\n  const DEFAULT_GUTTER = 25;\n  const booleanProps = [\"useTransform\", \"center\"];\n\n\n  if (!config) {\n    throw new Error(\"No config object has been provided.\");\n  }\n\n  for(let prop of booleanProps){\n    if(typeof config[prop] !== \"boolean\"){\n      config[prop] = true;\n    }\n  }\n\n\n  if(typeof config.gutter !== \"number\"){\n    config.gutter = DEFAULT_GUTTER;\n  }\n\n  if (!config.container) error(\"container\");\n  if (!config.items && !config.static) error(\"items or static\");\n};\n\n\n/**\n * Handles invalid configuration object\n * errors.\n *\n * @param prop - a property with a missing value\n */\nconst error = prop => {\n  throw new Error(`Missing property '${prop}' in MagicGrid config`);\n};\n\n/**\n * Finds the shortest column in\n * a column list.\n *\n * @param cols - list of columns\n *\n * @return shortest column\n */\nconst getMin = cols => {\n  let min = cols[0];\n\n  for (let col of cols) {\n    if (col.height < min.height) min = col;\n  }\n\n  return min;\n};\n\nexport {checkParams, getMin};\n","export const POSITIONING_COMPLETE_EVENT = \"positionComplete\";\nexport const REPOSITIONING_DELAY = 200;\n\n\n\n","/**\n * @author emmanuelolaojo\n * @since 11/10/18\n *\n * The MagicGrid class is an\n * implementation of a flexible\n * grid layout.\n */\n\nimport EventEmitter from \"./EventEmitter.js\";\nimport { checkParams, getMin } from \"./utils.js\";\nimport {POSITIONING_COMPLETE_EVENT, REPOSITIONING_DELAY} from \"./constant.js\";\n\nclass MagicGrid extends EventEmitter{\n  /**\n   * Initializes the necessary variables\n   * for a magic grid.\n   *\n   * @param config - configuration object\n   */\n  constructor (config) {\n    super();\n    checkParams(config);\n\n    if (config.container instanceof HTMLElement) {\n      this.container = config.container;\n      this.containerClass = config.container.className;\n    }\n    else {\n      this.containerClass = config.container;\n      this.container = document.querySelector(config.container);\n    }\n\n    this.static = config.static || false;\n    this.size = config.items;\n    this.gutter = config.gutter;\n    this.maxColumns = config.maxColumns || false;\n    this.useMin = config.useMin || false;\n    this.useTransform = config.useTransform;\n    this.animate = config.animate || false;\n    this.center = config.center;\n    this.styledItems = new Set();\n    this.resizeObserver = null;\n    this.isPositioning = false;\n  }\n\n  /**\n   * Initializes styles\n   *\n   * @private\n   */\n  initStyles () {\n    if (!this.ready()) return;\n\n    this.container.style.position = \"relative\";\n    const items = this.items();\n\n    for (let i = 0; i < items.length; i++) {\n      if (this.styledItems.has(items[i])) continue;\n\n      let style = items[i].style;\n\n      style.position = \"absolute\";\n\n      if (this.animate) {\n        style.transition = `${this.useTransform ? \"transform\" : \"top, left\"} 0.2s ease`;\n      }\n\n      this.styledItems.add(items[i]);\n    }\n  }\n\n  /**\n   * Gets a collection of all items in a grid.\n   *\n   * @return {HTMLCollection}\n   * @private\n   */\n  items () {\n    return this.container.children;\n  }\n\n  /**\n   * Calculates the width of a column.\n   *\n   * @return width of a column in the grid\n   * @private\n   */\n  colWidth () {\n    return this.items()[0].getBoundingClientRect().width + this.gutter;\n  }\n\n  /**\n   * Initializes an array of empty columns\n   * and calculates the leftover whitespace.\n   *\n   * @return {{cols: Array, wSpace: number}}\n   * @private\n   */\n  setup () {\n    let width = this.container.getBoundingClientRect().width;\n    let colWidth = this.colWidth();\n    let numCols = Math.floor(width/colWidth) || 1;\n    let cols = [];\n\n    if (this.maxColumns && numCols > this.maxColumns) {\n      numCols = this.maxColumns;\n    }\n\n    for (let i = 0; i < numCols; i++) {\n      cols[i] = {height: 0, index: i};\n    }\n\n    let wSpace = width - numCols * colWidth + this.gutter;\n\n    return {cols, wSpace};\n  }\n\n  /**\n   * Gets the next available column.\n   *\n   * @param cols list of columns\n   * @param i index of dom element\n   *\n   * @return {*} next available column\n   * @private\n   */\n  nextCol (cols, i) {\n    if (this.useMin) {\n      return getMin(cols);\n    }\n\n    return cols[i % cols.length];\n  }\n\n  /**\n   * Positions each item in the grid, based\n   * on their corresponding column's height\n   * and index then stretches the container to\n   * the height of the grid.\n   */\n  positionItems () {\n\n    if(this.isPositioning){\n      return;\n    }\n\n    this.isPositioning = true;\n\n    let { cols, wSpace } = this.setup();\n    let maxHeight = 0;\n    let colWidth = this.colWidth();\n    let items = this.items();\n\n    wSpace = this.center ? Math.floor(wSpace / 2) : 0;\n\n    this.initStyles();\n\n    for (let i = 0; i < items.length; i++) {\n      let col = this.nextCol(cols, i);\n      let item = items[i];\n      let topGutter = col.height ? this.gutter : 0;\n      let left = col.index * colWidth + wSpace + \"px\";\n      let top = col.height + topGutter + \"px\";\n\n      if(this.useTransform){\n        item.style.transform = `translate(${left}, ${top})`;\n      }\n      else{\n        item.style.top = top;\n        item.style.left = left;\n      }\n\n      col.height += item.getBoundingClientRect().height + topGutter;\n\n      if(col.height > maxHeight){\n        maxHeight = col.height;\n      }\n    }\n\n    this.container.style.height = maxHeight + this.gutter + \"px\";\n    this.isPositioning = false;\n    this.emit(POSITIONING_COMPLETE_EVENT);\n  }\n\n  /**\n   * Checks if every item has been loaded\n   * in the dom.\n   *\n   * @return {Boolean} true if every item is present\n   */\n  ready () {\n    if (this.static) return true;\n    return this.items().length >= this.size;\n  }\n\n  /**\n   * Periodically checks that all items\n   * have been loaded in the dom. Calls\n   * this.listen() once all the items are\n   * present.\n   *\n   * @private\n   */\n  getReady () {\n    let interval = setInterval(() => {\n      this.container = document.querySelector(this.containerClass);\n\n      if (this.ready()) {\n        clearInterval(interval);\n\n        this.listen();\n      }\n    }, 100);\n  }\n\n  observeContainerResize() {\n    if (this.resizeObserver) return;\n\n    this.resizeObserver = new ResizeObserver(() => {\n      setTimeout(() => {\n        this.positionItems();\n      }, REPOSITIONING_DELAY);\n\n    });\n\n    this.resizeObserver.observe(this.container);\n  }\n\n  /**\n   * Positions all the items and\n   * repositions them whenever the\n   * window size changes.\n   */\n  listen () {\n    if (this.ready()) {\n\n      window.addEventListener(\"resize\", () => {\n\n        setTimeout(() => {\n          this.positionItems();\n        }, REPOSITIONING_DELAY);\n\n      });\n\n      this.observeContainerResize();\n      this.positionItems();\n    }\n    else this.getReady();\n  }\n\n  onPositionComplete(callback) {\n    return this.addListener(POSITIONING_COMPLETE_EVENT, callback);\n  }\n}\n\nexport default MagicGrid;"],"names":["Listener","_createClass","id","event","handler","_classCallCheck","_defineProperty","this","_idCounter","WeakMap","error","prop","Error","concat","POSITIONING_COMPLETE_EVENT","_EventEmitter","MagicGrid","config","_this","_callSuper","_i","_booleanProps","length","gutter","container","items","checkParams","HTMLElement","containerClass","className","document","querySelector","size","maxColumns","useMin","useTransform","animate","center","styledItems","Set","resizeObserver","isPositioning","_inherits","key","value","ready","style","position","i","has","transition","add","children","getBoundingClientRect","width","colWidth","numCols","Math","floor","cols","height","index","wSpace","_step","min","_iterator","_createForOfIteratorHelper","s","n","done","col","err","e","f","getMin","_this$setup","setup","maxHeight","initStyles","nextCol","item","topGutter","left","top","transform","emit","_this2","interval","setInterval","clearInterval","listen","_this3","ResizeObserver","setTimeout","positionItems","observe","_this4","window","addEventListener","observeContainerResize","getReady","callback","addListener","EventEmitter","_classPrivateFieldInitSpec","listeners","_classPrivateFieldSet","findIndex","listener","splice","_this$idCounter","_this$idCounter2","push","payload"],"mappings":"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"}