!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).MagicGrid=t()}(this,(function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function t(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function n(e,t,n){return t=u(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,c()?Reflect.construct(t,[],u(e).constructor):t.apply(e,n))}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function o(e,n,r){return e.set(t(e,n),r),r}function s(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t))||n){r&&(t=r);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw s}}}}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(c=function(){return!!e})()}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function f(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function h(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function y(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var p=require("./listener.js"),v=new WeakMap,d=function(){return s((function e(){var t,n,s;r(this,e),t=this,s=void 0,(n=f(n="listeners"))in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,i(this,v,void 0),this.listeners=[],o(v,this,0)}),[{key:"removeListener",value:function(e){var t=this.listeners.findIndex((function(t){return t.id===e}));return-1!==t&&(this.listeners.splice(t,1),!0)}},{key:"addListener",value:function(e,n){var r,i,s,a,u=(o(v,this,(a=this,r=(s=v).get(t(s,a)),i=r++,r)),i);return this.listeners.push(new p(u,e,n)),u}},{key:"emit",value:function(e,t){var n,r=a(this.listeners);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.event===e&&i.handler(t)}}catch(e){r.e(e)}finally{r.f()}}}])}(),m=y(Object.freeze({__proto__:null,default:d})),b=function(e){throw new Error("Missing property '".concat(e,"' in MagicGrid config"))},g=y(Object.freeze({__proto__:null,checkParams:function(e){if(!e)throw new Error("No config object has been provided.");for(var t=0,n=["useTransform","center"];t<n.length;t++){var r=n[t];"boolean"!=typeof e[r]&&(e[r]=!0)}"number"!=typeof e.gutter&&(e.gutter=25),e.container||b("container"),e.items||e.static||b("items or static")},getMin:function(e){var t,n=e[0],r=a(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.height<n.height&&(n=i)}}catch(e){r.e(e)}finally{r.f()}return n}})),O=y(Object.freeze({__proto__:null,POSITIONING_COMPLETE_EVENT:"positionComplete",REPOSITIONING_DELAY:200})),w=m,_=g.checkParams,j=g.getMin,P=O.POSITIONING_COMPLETE_EVENT,E=O.REPOSITIONING_DELAY;return h(function(e){function t(e){var i;return r(this,t),i=n(this,t),_(e),e.container instanceof HTMLElement?(i.container=e.container,i.containerClass=e.container.className):(i.containerClass=e.container,i.container=document.querySelector(e.container)),i.static=e.static||!1,i.size=e.items,i.gutter=e.gutter,i.maxColumns=e.maxColumns||!1,i.useMin=e.useMin||!1,i.useTransform=e.useTransform,i.animate=e.animate||!1,i.center=e.center,i.styledItems=new Set,i.resizeObserver=null,i.isPositioning=!1,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(t,e),s(t,[{key:"setContainer",value:function(e){var t=this.container;this.container=e,this.resizeObserver.unobserve(t),this.resizeObserver.observe(e)}},{key:"initStyles",value:function(){if(this.ready()){this.container.style.position="relative";for(var e=this.items(),t=0;t<e.length;t++)if(!this.styledItems.has(e[t])){var n=e[t].style;n.position="absolute",this.animate&&(n.transition="".concat(this.useTransform?"transform":"top, left"," 0.2s ease")),this.styledItems.add(e[t])}}}},{key:"items",value:function(){return this.container.children}},{key:"colWidth",value:function(){return this.items()[0].getBoundingClientRect().width+this.gutter}},{key:"setup",value:function(){var e=this.container.getBoundingClientRect().width,t=this.colWidth(),n=Math.floor(e/t)||1,r=[];this.maxColumns&&n>this.maxColumns&&(n=this.maxColumns);for(var i=0;i<n;i++)r[i]={height:0,index:i};return{cols:r,wSpace:e-n*t+this.gutter}}},{key:"nextCol",value:function(e,t){return this.useMin?j(e):e[t%e.length]}},{key:"positionItems",value:function(){if(!this.isPositioning){this.isPositioning=!0;var e=this.setup(),t=e.cols,n=e.wSpace,r=0,i=this.colWidth(),o=this.items();n=this.center?Math.floor(n/2):0,this.initStyles();for(var s=0;s<o.length;s++){var a=this.nextCol(t,s),u=o[s],c=a.height?this.gutter:0,l=a.index*i+n+"px",f=a.height+c+"px";this.useTransform?u.style.transform="translate(".concat(l,", ").concat(f,")"):(u.style.top=f,u.style.left=l),a.height+=u.getBoundingClientRect().height+c,a.height>r&&(r=a.height)}this.container.style.height=r+this.gutter+"px",this.isPositioning=!1,this.emit(P)}}},{key:"ready",value:function(){return!!this.static||this.items().length>=this.size}},{key:"getReady",value:function(){var e=this,t=setInterval((function(){e.container=document.querySelector(e.containerClass),e.ready()&&(clearInterval(t),e.listen())}),100)}},{key:"observeContainerResize",value:function(){var e=this;this.resizeObserver||(this.resizeObserver=new ResizeObserver((function(){setTimeout((function(){e.positionItems()}),E)})),this.resizeObserver.observe(this.container))}},{key:"listen",value:function(){var e=this;this.ready()?(window.addEventListener("resize",(function(){setTimeout((function(){e.positionItems()}),E)})),this.observeContainerResize(),this.positionItems()):this.getReady()}},{key:"onPositionComplete",value:function(e){return this.addListener(P,e)}}])}(w))}));
